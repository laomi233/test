// ResponsiveTable.js - React Component
import React from 'react';
import { MapTo } from '@adobe/aem-react-editable-components';
import './ResponsiveTable.css';

const ResponsiveTableConfig = {
  emptyLabel: 'Responsive Table',
  isEmpty: function(props) {
    return !props.tableData || props.tableData.length === 0;
  }
};

const ResponsiveTable = (props) => {
  const { 
    tableData = [], 
    headers = [], 
    caption,
    striped = false,
    bordered = true,
    hoverable = true,
    responsive = true
  } = props;

  if (!tableData || tableData.length === 0) {
    return (
      <div className="cmp-table cmp-table--empty">
        <p>No table data available. Please configure the component.</p>
      </div>
    );
  }

  return (
    <div className={`cmp-table ${responsive ? 'cmp-table--responsive' : ''}`}>
      {caption && <div className="cmp-table__caption">{caption}</div>}
      
      <div className="cmp-table__wrapper">
        <table 
          className={`
            cmp-table__element
            ${striped ? 'cmp-table--striped' : ''}
            ${bordered ? 'cmp-table--bordered' : ''}
            ${hoverable ? 'cmp-table--hoverable' : ''}
          `.trim()}
        >
          <thead className="cmp-table__head">
            <tr>
              {headers.map((header, idx) => (
                <th 
                  key={idx} 
                  className="cmp-table__header"
                  data-label={header}
                >
                  {header}
                </th>
              ))}
            </tr>
          </thead>
          <tbody className="cmp-table__body">
            {tableData.map((row, rowIdx) => (
              <tr key={rowIdx} className="cmp-table__row">
                {row.map((cell, cellIdx) => (
                  <td 
                    key={cellIdx} 
                    className="cmp-table__cell"
                    data-label={headers[cellIdx]}
                  >
                    {cell}
                  </td>
                ))}
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
};

export default MapTo('myproject/components/content/responsivetable')(
  ResponsiveTable,
  ResponsiveTableConfig
);

// ResponsiveTable.css
.cmp-table {
  width: 100%;
  margin: 1rem 0;
}

.cmp-table__caption {
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: 0.75rem;
  text-align: left;
}

.cmp-table__wrapper {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

.cmp-table__element {
  width: 100%;
  border-collapse: collapse;
  background-color: #fff;
}

.cmp-table__header {
  padding: 0.75rem 1rem;
  text-align: left;
  font-weight: 600;
  background-color: #f8f9fa;
  border-bottom: 2px solid #dee2e6;
}

.cmp-table__cell {
  padding: 0.75rem 1rem;
  border-bottom: 1px solid #dee2e6;
}

/* Striped rows */
.cmp-table--striped .cmp-table__body .cmp-table__row:nth-child(odd) {
  background-color: #f8f9fa;
}

/* Bordered table */
.cmp-table--bordered .cmp-table__header,
.cmp-table--bordered .cmp-table__cell {
  border: 1px solid #dee2e6;
}

/* Hoverable rows */
.cmp-table--hoverable .cmp-table__body .cmp-table__row:hover {
  background-color: #f1f3f5;
  cursor: pointer;
}

/* Empty state */
.cmp-table--empty {
  padding: 2rem;
  text-align: center;
  background-color: #f8f9fa;
  border: 2px dashed #dee2e6;
  border-radius: 4px;
}

/* Responsive styles for mobile */
@media screen and (max-width: 768px) {
  .cmp-table--responsive .cmp-table__element,
  .cmp-table--responsive .cmp-table__head,
  .cmp-table--responsive .cmp-table__body,
  .cmp-table--responsive .cmp-table__row,
  .cmp-table--responsive .cmp-table__header,
  .cmp-table--responsive .cmp-table__cell {
    display: block;
  }

  .cmp-table--responsive .cmp-table__head {
    display: none;
  }

  .cmp-table--responsive .cmp-table__row {
    margin-bottom: 1rem;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    overflow: hidden;
  }

  .cmp-table--responsive .cmp-table__cell {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 1rem;
    border-bottom: 1px solid #dee2e6;
  }

  .cmp-table--responsive .cmp-table__cell:last-child {
    border-bottom: none;
  }

  .cmp-table--responsive .cmp-table__cell::before {
    content: attr(data-label);
    font-weight: 600;
    margin-right: 1rem;
    flex-shrink: 0;
  }

  .cmp-table--responsive .cmp-table__cell:empty::before {
    content: none;
  }
}

/* Tablet breakpoint */
@media screen and (min-width: 769px) and (max-width: 1024px) {
  .cmp-table__header,
  .cmp-table__cell {
    padding: 0.5rem 0.75rem;
    font-size: 0.9rem;
  }
}

// _cq_dialog/.content.xml - AEM Dialog Configuration
<?xml version="1.0" encoding="UTF-8"?>
<jcr:root xmlns:sling="http://sling.apache.org/jcr/sling/1.0"
          xmlns:cq="http://www.day.com/jcr/cq/1.0"
          xmlns:jcr="http://www.jcp.org/jcr/1.0"
          xmlns:nt="http://www.jcp.org/jcr/nt/1.0"
          jcr:primaryType="nt:unstructured"
          jcr:title="Responsive Table"
          sling:resourceType="cq/gui/components/authoring/dialog">
    <content
        jcr:primaryType="nt:unstructured"
        sling:resourceType="granite/ui/components/coral/foundation/container">
        <items jcr:primaryType="nt:unstructured">
            <tabs
                jcr:primaryType="nt:unstructured"
                sling:resourceType="granite/ui/components/coral/foundation/tabs"
                maximized="{Boolean}true">
                <items jcr:primaryType="nt:unstructured">
                    <general
                        jcr:primaryType="nt:unstructured"
                        jcr:title="General"
                        sling:resourceType="granite/ui/components/coral/foundation/container">
                        <items jcr:primaryType="nt:unstructured">
                            <columns
                                jcr:primaryType="nt:unstructured"
                                sling:resourceType="granite/ui/components/coral/foundation/fixedcolumns"
                                margin="{Boolean}true">
                                <items jcr:primaryType="nt:unstructured">
                                    <column
                                        jcr:primaryType="nt:unstructured"
                                        sling:resourceType="granite/ui/components/coral/foundation/container">
                                        <items jcr:primaryType="nt:unstructured">
                                            <caption
                                                jcr:primaryType="nt:unstructured"
                                                sling:resourceType="granite/ui/components/coral/foundation/form/textfield"
                                                fieldLabel="Table Caption"
                                                name="./caption"/>
                                            <tableData
                                                jcr:primaryType="nt:unstructured"
                                                sling:resourceType="granite/ui/components/coral/foundation/form/multifield"
                                                fieldLabel="Table Rows"
                                                composite="{Boolean}true">
                                                <field
                                                    jcr:primaryType="nt:unstructured"
                                                    sling:resourceType="granite/ui/components/coral/foundation/container"
                                                    name="./tableData">
                                                    <items jcr:primaryType="nt:unstructured">
                                                        <row
                                                            jcr:primaryType="nt:unstructured"
                                                            sling:resourceType="granite/ui/components/coral/foundation/form/multifield"
                                                            fieldLabel="Row Data">
                                                            <field
                                                                jcr:primaryType="nt:unstructured"
                                                                sling:resourceType="granite/ui/components/coral/foundation/form/textfield"
                                                                name="./cell"/>
                                                        </row>
                                                    </items>
                                                </field>
                                            </tableData>
                                        </items>
                                    </column>
                                </items>
                            </columns>
                        </items>
                    </general>
                    <options
                        jcr:primaryType="nt:unstructured"
                        jcr:title="Options"
                        sling:resourceType="granite/ui/components/coral/foundation/container">
                        <items jcr:primaryType="nt:unstructured">
                            <columns
                                jcr:primaryType="nt:unstructured"
                                sling:resourceType="granite/ui/components/coral/foundation/fixedcolumns"
                                margin="{Boolean}true">
                                <items jcr:primaryType="nt:unstructured">
                                    <column
                                        jcr:primaryType="nt:unstructured"
                                        sling:resourceType="granite/ui/components/coral/foundation/container">
                                        <items jcr:primaryType="nt:unstructured">
                                            <striped
                                                jcr:primaryType="nt:unstructured"
                                                sling:resourceType="granite/ui/components/coral/foundation/form/checkbox"
                                                fieldDescription="Enable striped rows"
                                                name="./striped"
                                                text="Striped"
                                                value="{Boolean}true"/>
                                            <bordered
                                                jcr:primaryType="nt:unstructured"
                                                sling:resourceType="granite/ui/components/coral/foundation/form/checkbox"
                                                fieldDescription="Enable borders"
                                                name="./bordered"
                                                text="Bordered"
                                                checked="{Boolean}true"
                                                value="{Boolean}true"/>
                                            <hoverable
                                                jcr:primaryType="nt:unstructured"
                                                sling:resourceType="granite/ui/components/coral/foundation/form/checkbox"
                                                fieldDescription="Enable hover effect"
                                                name="./hoverable"
                                                text="Hoverable"
                                                checked="{Boolean}true"
                                                value="{Boolean}true"/>
                                            <responsive
                                                jcr:primaryType="nt:unstructured"
                                                sling:resourceType="granite/ui/components/coral/foundation/form/checkbox"
                                                fieldDescription="Enable responsive layout"
                                                name="./responsive"
                                                text="Responsive"
                                                checked="{Boolean}true"
                                                value="{Boolean}true"/>
                                        </items>
                                    </column>
                                </items>
                            </columns>
                        </items>
                    </options>
                </items>
            </tabs>
        </items>
    </content>
</jcr:root>

// ResponsiveTableModel.java - Sling Model
package com.myproject.core.models;

import com.adobe.cq.export.json.ComponentExporter;
import com.adobe.cq.export.json.ExporterConstants;
import org.apache.sling.api.SlingHttpServletRequest;
import org.apache.sling.models.annotations.DefaultInjectionStrategy;
import org.apache.sling.models.annotations.Exporter;
import org.apache.sling.models.annotations.Model;
import org.apache.sling.models.annotations.injectorspecific.ValueMapValue;

import javax.annotation.PostConstruct;
import java.util.ArrayList;
import java.util.List;

@Model(
    adaptables = SlingHttpServletRequest.class,
    adapters = {ResponsiveTableModel.class, ComponentExporter.class},
    resourceType = ResponsiveTableModel.RESOURCE_TYPE,
    defaultInjectionStrategy = DefaultInjectionStrategy.OPTIONAL
)
@Exporter(
    name = ExporterConstants.SLING_MODEL_EXPORTER_NAME,
    extensions = ExporterConstants.SLING_MODEL_EXTENSION
)
public class ResponsiveTableModel implements ComponentExporter {

    static final String RESOURCE_TYPE = "myproject/components/content/responsivetable";

    @ValueMapValue
    private String caption;

    @ValueMapValue
    private Boolean striped;

    @ValueMapValue
    private Boolean bordered;

    @ValueMapValue
    private Boolean hoverable;

    @ValueMapValue
    private Boolean responsive;

    private List<List<String>> tableData;
    private List<String> headers;

    @PostConstruct
    protected void init() {
        // Initialize table data from JCR
        // This is a simplified version - you'd parse from multifield
        tableData = new ArrayList<>();
        headers = new ArrayList<>();
        
        // Sample data structure - adjust based on your dialog structure
        headers.add("Column 1");
        headers.add("Column 2");
        headers.add("Column 3");
    }

    public String getCaption() {
        return caption;
    }

    public Boolean getStriped() {
        return striped != null ? striped : false;
    }

    public Boolean getBordered() {
        return bordered != null ? bordered : true;
    }

    public Boolean getHoverable() {
        return hoverable != null ? hoverable : true;
    }

    public Boolean getResponsive() {
        return responsive != null ? responsive : true;
    }

    public List<List<String>> getTableData() {
        return tableData;
    }

    public List<String> getHeaders() {
        return headers;
    }

    @Override
    public String getExportedType() {
        return RESOURCE_TYPE;
    }
}

// import-components.js - Register the component
import './components/ResponsiveTable/ResponsiveTable';

// Usage Example in another component
import React from 'react';
import ResponsiveTable from './ResponsiveTable';

const ExampleUsage = () => {
  const sampleData = {
    caption: "Sales Report Q4 2024",
    headers: ["Product", "Units Sold", "Revenue", "Growth"],
    tableData: [
      ["Product A", "1,234", "$45,678", "+12%"],
      ["Product B", "2,345", "$67,890", "+8%"],
      ["Product C", "3,456", "$89,012", "+15%"],
      ["Product D", "4,567", "$123,456", "+20%"]
    ],
    striped: true,
    bordered: true,
    hoverable: true,
    responsive: true
  };

  return <ResponsiveTable {...sampleData} />;
};